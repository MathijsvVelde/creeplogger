'use server';
// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Caml_option from "rescript/lib/es6/caml_option.js";
import * as Core__Option from "@rescript/core/src/Core__Option.bs.mjs";
import * as RescriptCore from "@rescript/core/src/RescriptCore.bs.mjs";

var url = process.env.MATTERMOST_URL;

var isEnabled = process.env.MATTERMOST_ENABLED === "true";

function publishMessage(message) {
  if (url !== undefined) {
    if (isEnabled) {
      console.log(Core__Option.getExn(JSON.stringify(message)));
      return Caml_option.some(fetch(Caml_option.valFromOption(url), {
                      method: "POST",
                      body: Caml_option.some(Core__Option.getExn(JSON.stringify({
                                    text: message
                                  })))
                    }));
    } else {
      return ;
    }
  } else if (isEnabled) {
    return RescriptCore.panic("MATTERMOST_URL not set");
  } else {
    return ;
  }
}

async function sendCreepsUpdate(bluePlayers, redPlayers, blueScore, redScore, points) {
  var blueNames = bluePlayers.map(function (player) {
          var handle = player.mattermostHandle;
          if (handle !== undefined) {
            return "@" + handle;
          } else {
            return player.name;
          }
        }).join(", ");
  var redNames = redPlayers.map(function (player) {
          var handle = player.mattermostHandle;
          if (handle !== undefined) {
            return "@" + handle;
          } else {
            return player.name;
          }
        }).join(", ");
  var bluePoints = blueScore > redScore ? -points | 0 : points;
  var redPoints = blueScore < redScore ? -points | 0 : points;
  var message = "### Nieuw potje geregistreerd!\n\n| Team | Goals | Punten |\n| ---- | ----- | ------ |\n| " + blueNames + " | " + blueScore.toString() + " | " + bluePoints.toString() + " |\n| " + redNames + " | " + redScore.toString() + " | " + redPoints.toString() + " |\n";
  var promise = publishMessage(message);
  if (promise !== undefined) {
    await Caml_option.valFromOption(promise);
  }
  return 0;
}

export {
  sendCreepsUpdate ,
  publishMessage ,
}
/* url Not a pure module */
